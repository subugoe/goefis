[% department = thisPerson.department %]

<!-- BEGIN backend/user_settings.tt -->

[% IF thisPerson.super_admin OR thisPerson.reviewer OR thisPerson.data_manager %]
	<h5>[% lf.header.role_label %]: [% lf.header.role.item(session.role) %]</h5>
	([% lf.header.role_change %]
	[% IF session.role != "user" %]
		<a href="[% IF session.role != "user" %]/librecat/change_role/user[% END %]">[% lf.header.role.user %]</a>
	[% END %]
	[% IF thisPerson.delegate AND session.role != "delegate" %]
		| <a href="/librecat/change_role/delegate">[% lf.header.role.delegate %]</a>
	[% END %]
	[% IF thisPerson.reviewer AND session.role != "reviewer" %]
		| <a href="/librecat/change_role/reviewer">[% lf.header.role.reviewer %]</a>
	[% END %]
	[% IF thisPerson.data_manager AND session.role != "data_manager" %]
		| <a href="/librecat/change_role/data_manager">[% lf.header.role.data_manager %]</a>
	[% END %]
	[% IF thisPerson.super_admin AND session.role != "super_admin" %]
		| <a href="/librecat/change_role/admin">[% lf.header.role.super_admin %]</a>
	[% END %]
	)
[% END %]

<form id="id_save_aff" action="/librecat/person/affiliation" method="POST">
	<h4>[% lf.header.department_affiliation %]</h4>
	<div id="person_affiliation">
		[% IF !department %]
			<input type="hidden" name="department.0._id" id="person_aff_idautocomplete_0" value="" />
			<div class="form-group">
				<div class="input-group">
					<input type="text" onfocus="enable_autocomplete('person_aff',0);" class="sticky form-control" id="person_aff_autocomplete_0" value="" />
					<div class="input-group-addon" onclick="add_field('person_affiliation');">[+]</div>
					<div class="input-group-addon" onclick="remove_field(this);">[-]</div>
				</div>
			</div>
		[% ELSE %]
			[% FOREACH dept IN department %]
				<input type="hidden" name="department.[% loop.index %]._id" id="person_aff_idautocomplete_[% loop.index %]" value="[% dept._id %]" />
				<div class="form-group">
					<div class="input-group">
						<input type="text" onfocus="enable_autocomplete('person_aff',[% loop.index %]);" class="sticky form-control" id="person_aff_autocomplete_[% loop.index %]" value="[% h.get_department(dept._id).display %]" disabled="disabled" />
						<div class="input-group-addon" onclick="add_field('person_affiliation');">[+]</div>
						<div class="input-group-addon" onclick="remove_field(this);submit_form('id_save_aff');">[-]</div>
					</div>
				</div>
			[% END %]
		[% END %]
	</div>
</form>

<form id="id_save_mode" action="/librecat/person/edit_mode" method="POST">
	<h4>[% lf.header.default_edit_mode %]</h4>
	<select id="edit_mode_select" name="edit_mode" class="form-control">
		<option value="normal"[% IF (thisPerson.edit_mode AND thisPerson.edit_mode == "normal") OR (!thisPerson.edit_mode AND session.role != "super_admin") %] selected="selected"[% END %]>[% lf.forms.tab_form %]</option>
		<option value="expert"[% IF (thisPerson.edit_mode AND thisPerson.edit_mode == "expert") OR (!thisPerson.edit_mode AND session.role == "super_admin") %] selected="selected"[% END %]>[% lf.forms.sp_form %]</option>
	</select>
</form>

<form id="id_save_lang" action="/librecat/person/set_language" method="GET">
			<h4>[% lf.header.default_language %]</h4>
			<select id="lang_select" name="lang" class="form-control">
				<option value="en"[% IF (thisPerson.lang AND thisPerson.lang == "en") OR !thisPerson.lang %] selected="selected"[% END %]>[% lf.header.lang_select.eng %]</option>
				<option value="de"[% IF (thisPerson.lang AND thisPerson.lang == "de") %] selected="selected"[% END %]>[% lf.header.lang_select.ger %]</option>
			</select>
</form>

<script>
	$(function(){
		$('#role_select').on("change", function(){
			console.log('#role_select');
			window.location = $(this).val();
		});
	});
	$('#edit_mode_select').on("change", function(){
		console.log('#edit_mode_select');
		submit_form('id_save_mode');
	});
	$('#lang_select').on("change", function(){
		console.log('#lang_select');
		submit_form('id_save_lang');
	});
	function submit_form(form_id){
		$('#' + form_id).submit();
	}
</script>
<!-- END backend/user_settings.tt -->
